var e,t,n,i,o,r,s,a,l,u,h,f={d:(e,t)=>{for(var n in t)f.o(t,n)&&!f.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},p={};f.d(p,{Fd:()=>I,RV:()=>k,_K:()=>at,Gm:()=>ot,fc:()=>_e,$o:()=>e,JX:()=>st,v1:()=>ct,uL:()=>V,c8:()=>dt}),function(e){e[e.PROP=0]="PROP",e[e.ATTR=1]="ATTR"}(e||(e={})),function(e){e.Registered="registered",e.Deregistered="deregistered",e.AlreadyRegistered="already-registered",e.NodeAlreadyHasId="node-already-has-id"}(t||(t={})),function(e){e.BindingElementHasNoBindKey="binding-element-has-no-bind-key",e.InitiatingBinding="initiating-binding",e.ReceivedBindingRequest="received-binding-request",e.RegisteringBinding="registering-binding",e.DeregisteringBinding="deregistering-binding",e.Subscribed="subscribed",e.BindingValueChanged="binding-value-changed",e.ReceivedBindingUpdate="received-binding-update",e.BindingPermissionDenied="binding-permission-denied",e.IkaABReceivedBindingUpdate="ika-ab-received-binding-update",e.NoBindingValueUpdateHandler="no-binding-value-update-handler",e.NoParentFound="binding-element-no-parent-found",e.UnregisteredNodeSubscribing="unregistered-node-subscribing"}(n||(n={})),function(e){e.Building="building",e.Built="built",e.NoStateDataWhenInitialising="no-state-data-when-initialising",e.ReceivedEvent="received-event",e.ReceivedEventNotFromElement="received-event-not-from-element",e.ReceviedComponentCallNoDetail="received-component-call-no-detail"}(i||(i={})),function(e){e.Initialising="initialising-ika",e.BufferStart="buffer-start"}(o||(o={})),function(e){e.NotAttributeMutation="not-attribute-mutation",e.UnwatchedAttribute="unwatched-attribute",e.MutationTargetUnexpected="mutation-target-unexpected"}(r||(r={})),function(e){e.ImportedNodes="imported-nodes",e.RemovedNode="mut-observer-removed-node",e.ImportWithSameTemplateID="import-with-same-template-id",e.ImportComponentWithNoMD5="import-component-with-no-md5"}(s||(s={})),function(e){e.AwaitCustomElementDefinitionTimeout="await-timeout",e.MappingInitiated="mapping-initiated",e.NoBindingDictionary="no-bd",e.UnexpectedBDType="unexpected-bd-type",e.UnexpectedBDStateObject="unexpected-bd-state-object",e.UnexpectedBDOutputType="unexpected-bd-output-type",e.UnexpectedBDOutputValue="unexpected-bd-output-val",e.NoMapFrom="no-map-from",e.UnexpectedMFType="unexpected-mf-type",e.NestedIkaMEHasISAttr="nested-ika-me-has-is-attr",e.StateMappingNotOnIkaComponent="state-mapping-not-on-ika-component"}(a||(a={})),function(e){e.UnexpectedData="unexpected-data"}(l||(l={})),function(e){e.OverwritingKey="overwriting-router-key"}(u||(u={})),function(e){e.HasCachedData="has-cached-data",e.MakingFetch="making-fetch",e.FetchFailed="fetch-failed",e.WritingIntoCache="writing-into-cache",e.RequesterHasNoId="requester-has-no-id"}(h||(h={}));var m,g=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};function b(){Object.entries(dt.buffer.getBuffer()).forEach((([t,n])=>{const i=dt.reg.getNodeFromId(t);e.PROP in n&&Object.entries(n[e.PROP]).forEach((([e,t])=>{i[e]=t.pop()})),e.ATTR in n&&i.nodeType==Node.ELEMENT_NODE&&Object.entries(n[e.ATTR]).forEach((([e,t])=>{i.setAttribute(e,t.pop().toString())}))})),dt.buffer.resetBuffer()}m=new WeakMap;var w,y=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};class v{constructor(){w.set(this,void 0),function(e,t,n,i,o){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===i?o.call(e,n):o?o.value=n:t.set(e,n)}(this,w,[],"f")}queue(){return new Promise(((e,t)=>{y(this,w,"f").push(e),1==y(this,w,"f").length&&e()}))}next(){y(this,w,"f").shift(),y(this,w,"f")[0]&&y(this,w,"f")[0]()}}function N(e){const t=e.composedPath()[0],n=t instanceof HTMLElement?t.tagName.toLowerCase():"NOT_AN_HTML_ELEMENT";return{eventSource:t,tagName:n}}w=new WeakMap;const C={"en-gb":{[t.Registered]:(e,t)=>({s:`Registered node %c<${e.tagName.toLowerCase()}>%c with ID %c${t}%c\n        Element: %o`,o:[e],css:[E.ComponentName,"color: unset",E.NodeID,E.Unset]}),[t.Deregistered]:(e,t)=>({s:`Node %c<${e}>%c with ID %c${t}%c is deregistered`,css:[E.ComponentName,"color: unset",E.NodeID,"color: unset"]}),[t.AlreadyRegistered]:(e,t)=>({s:`Another registration request is made for a node. It's currently registered as %c${e}\n%o`,css:[E.NodeID],o:[t],mode:"warn"}),[t.NodeAlreadyHasId]:(e,t)=>({s:`Node id already set to %c${e}%c on component %c<${t.tagName.toLowerCase()}>\n%o`,o:[t],css:[E.NodeID,"color: unset",E.ComponentName,"color: unset"],mode:"error"}),[n.BindingElementHasNoBindKey]:e=>({s:"A binding component does not have a bind key attribute.\n        Element: $o",o:[e],mode:"warn"}),[n.InitiatingBinding]:(e,t)=>({s:`Component %c<${e}>%c is sending bind registration to parent %c<${t}>`,css:[E.ComponentName,E.Unset,E.ComponentName]}),[n.ReceivedBindingRequest]:()=>({s:""}),[n.RegisteringBinding]:(e,t)=>({s:`Registering binding to %c"${e}"%c by component %c<${t}>`,css:[E.VariableValue,"color: unset",E.ComponentName]}),[n.DeregisteringBinding]:(e,t)=>({s:`Deregistering binding to %c"${e}"%c by component %c<${t}>`,css:[E.VariableValue,"color: unset",E.ComponentName]}),[n.Subscribed]:(e,t)=>({s:`Node %c${e}%c is subscribed to bind key %c"${t}"%c`,css:[E.NodeID,E.Unset,E.VariableValue,E.Unset]}),[n.BindingPermissionDenied]:(e,t)=>({s:`Bind by node %c${e} onto key "%c${t}%c" failed as this node is not permissioned.`,css:[E.NodeID,"color: unset",E.VariableValue,"color: unset"]}),[n.BindingValueChanged]:(e,t,n,i)=>({s:`Bind "%c${e}%c" changed, triggering ${i} callbacks\n        Source: %c%o%c\n        Value: ${new Set(["string","number","boolean","undefined","null"]).has(typeof n)?'"%c%o%c"':"%o"}`,o:[t,n],css:[E.VariableValue,E.Unset,E.ComponentName,E.Unset,E.VariableValue,E.Unset]}),[n.ReceivedBindingUpdate]:(e,t)=>({s:`%c<${e}>%c received binding update for key %c"${t}"`,css:[E.ComponentName,E.Unset,E.VariableValue]}),[n.IkaABReceivedBindingUpdate](e,t,n,i,o){const r=Object.values(o);return{s:`%c<ika-ab>%c received binding update.\n        Bind: %c"${t}"%c\n        Value: %o\n        Attributes: ${i.length}, ${i.join(", ")}\n        Targets: ${r.length}, %o\n        Source: %o`,o:[n,r,e],css:[E.ComponentName,E.Unset]}},[n.NoBindingValueUpdateHandler]:e=>({s:`Component %c<${e}>%c did not implement state change callback.`,css:[E.ComponentName,"color: unset"],mode:"warn"}),[n.NoParentFound]:e=>({s:`Could not register bind for %c<${e.tagName.toLowerCase()}>%c as no parent was found.`,css:[E.ComponentName,"color: unset"],mode:"warn"}),[n.UnregisteredNodeSubscribing]:e=>({s:`Subscribing to bind must specify bind key, node ID, and a callback function. Check if the node requesting the binding has registered for a node ID.\nKey: ${e}`,mode:"error"}),[i.Building]:e=>({s:`Building component %c<${e.tagName.toLowerCase()}>%c\n        Component: %o`,o:[e],css:[E.ComponentName,E.Unset]}),[i.NoStateDataWhenInitialising]:(e,t)=>({s:`No data is available to initialise states for component %c<${e}>%c in instance space "${t}".`,css:[E.ComponentName,"color: unset",E.VariableValue,"color: unset"]}),[i.Built]:e=>({s:`Component %c<${e.tagName.toLowerCase()}>%c is constructed.\n        Component: %o`,o:[e],css:[E.ComponentName,"color: unset"]}),[i.ReceivedEvent](e,t){const{eventSource:n,tagName:i}=N(t),o=t instanceof CustomEvent?t.detail?.type:null,r=o?`        Type: %c${o}%c\n`:"";return{s:`Component %c<${e}>%c received event %c${t.type}%c\n${r}        Source: %o`,o:[n],css:[E.ComponentName,"color: unset",E.VariableValue,"color: unset",E.VariableValue,"color: unset"]}},[i.ReceivedEventNotFromElement]:e=>({s:"Received an event that did not originate from an HTMLElement. No action taken.",o:[e]}),[i.ReceviedComponentCallNoDetail](e,t){const{eventSource:n,tagName:i}=N(t);return{s:`%c<${e}>%c received component call from %c<${i}>%c but it did not contain detail.\nEvent: %o`,o:[t]}},[o.Initialising]:e=>({s:`Ika initialising... v${e}`}),[o.BufferStart]:()=>({s:"Buffer processing started at "+Math.round(performance.measure("ika-buf-started","ika-init").duration)+" ms"}),[r.NotAttributeMutation]:e=>({s:"Unexpected mutation record: This is not a attribute mutation.\n%o",o:[e],mode:"error"}),[r.UnwatchedAttribute]:e=>({s:"Unexpected mutation record: This attribute change is not watched and has no handler.\n%o",o:[e],mode:"error"}),[r.MutationTargetUnexpected]:e=>({s:"Unexpected mutation record: The mutation target is not the expected Ika component.\n%o",o:[e],mode:"error"}),[s.ImportWithSameTemplateID]:(e,t)=>({s:`Import with same template ID detected: Importing %c"${e}"%c from %c"${t}"%c.`,css:[E.VariableValue,E.Unset,E.VariableValue,E.Unset],mode:"warn"}),[s.ImportComponentWithNoMD5]:e=>({s:`Importing component from "%c${e}"%c but no MD5 was provided. Consider adding the MD5 hash to the component you are importing to detect import conflicts.`,css:[E.VariableValue,E.Unset],mode:"warn"}),[s.RemovedNode](e,t,n){const i=0==n.n.length?"No nodes left in DOM are associated with this import. Template and script nodes will now be removed.":`${n.n.length} nodes associated with this import are left in DOM.`;return{s:`${t.length} import related nodes were removed from DOM.\n${i}\nPath: %c${e}%c\nRemoved: %o\n\nRecord: %o`,o:[t.flatMap((e=>e.removedNodes.values())),n],css:[E.NodeID,E.Unset]}},[s.ImportedNodes]:(e,t)=>({s:`Loaded content from HTML, registered ${t.t.length} templates and ${t.n.length} nodes.\nPath: %c${e}%c\nNodes: %o`,o:[t],css:[E.NodeID,E.Unset]}),[a.AwaitCustomElementDefinitionTimeout]:(e,t)=>({s:`Custom element %c<${e}>%c was not defined within ${t}ms.\nThe element will still be mapped when it's defined, but check if the element name is correct.`,css:[E.ComponentName,E.Unset,E.VariableValue,E.Unset],mode:"warn"}),[a.MappingInitiated]:(e,t)=>({s:`%c<ika-me>%c is creating ${e} %c<${t}>%c elements...`,css:[E.ComponentName,E.Unset,E.ComponentName,E.Unset]}),[a.NoBindingDictionary]:e=>({s:"No binding dictionary is supplied to %c<ika-me>%c, and it will therefore be unable to map elements.\nGlobal state variable value: %o",css:[E.ComponentName,E.Unset],o:[e],mode:"error"}),[a.UnexpectedBDType]:e=>({s:`Unexpected binding dictionary: the type supplied is %c"${typeof e}"%c.`,css:[E.VariableValue,E.Unset],mode:"error"}),[a.UnexpectedBDStateObject]:()=>({s:"Unexpected binding dictionary state object: it should be a KV of functions.",mode:"error"}),[a.UnexpectedBDOutputType]:e=>({s:`Unexpected output from binding dictionary transformation function. Expecting KV pairs, got %c"${typeof e}"%c`,css:[E.VariableValue,E.Unset],mode:"error"}),[a.UnexpectedBDOutputValue]:(e,t)=>({s:`Unexpected value from binding dictionary transformation output: expecting string or number for key %c"${e}"%c, got %c"${typeof t}"%c.`,css:[E.VariableValue,E.Unset,E.VariableValue,E.Unset],mode:"error"}),[a.NoMapFrom]:e=>({s:`%c<ika-me>%c: No map from array under key "${e}". %c<ika-me>%c will clear its children.`}),[a.UnexpectedMFType]:e=>({s:`%c<ika-me>%c is asked to map from a value that is not an array, received %c"${typeof e}"%c.\nValue: %o`,css:[E.ComponentName,E.Unset,E.VariableValue],o:[e],mode:"error"}),[a.NestedIkaMEHasISAttr]:e=>({s:"A nested %c<ika-me>%c element has an instance space attribute. It inherits the top level instance space, and its mf attribute is the sub key in the mapped object.\n%o",css:[E.ComponentName,E.Unset],o:[e],mode:"error"}),[a.StateMappingNotOnIkaComponent]:(e,t)=>({s:`The binding dictionary includes state mapping, but the element mapped is not an Ika component, and therefore cannot be set states.\nBinding dictionary: %o\nElement mapped: ${t}`,o:[e],mode:"warn"}),[l.UnexpectedData]:e=>({s:"Unexpected data type being pushed to Ika Buffer, push rejected.\n%o",o:[e],mode:"error"}),[u.OverwritingKey]:(e,t)=>({s:`A router already exists under the key ${e}. Overwriting this registration now with ${t}`,mode:"warn"}),[h.FetchFailed]:(e,t,n,i)=>({s:`Fetching resource failed.\nURL: %o\nOptions: %o\nStatus: ${n}\nBody: ${i}`,o:[e,t],mode:"error"}),[h.HasCachedData]:(e,t)=>({s:"Cached data found for the requested resource.\nURL: %o\nOptions: %o",o:[e]}),[h.MakingFetch]:(e,t)=>({s:"Resource not found in cached data, making fetch request.\nURL: %o\nOptions: %o",o:[e,t]}),[h.WritingIntoCache]:(e,t,n,i)=>({s:`Resource loaded from ${i?"static resource":"network"}, writing into cache.\nURL: %o\nOptions: %o\nData: %o`,o:[e,t,n]}),[h.RequesterHasNoId]:e=>({s:`A node that does not have an ID requested a resource from Resource Manager.\nURL: ${e}`,mode:"warn"})}};var E,k,I,T;(T=E||(E={})).ComponentName="color: #60d38e",T.VariableValue="color: #ab49f5",T.NodeID="color: #999",T.Unset="color: unset",function(e){e.ComponentCall="ika-component-call",e.GetTopLevelIkaME="ika-me-seek"}(k||(k={})),function(e){let t;!function(e){e.RegisterBind="REGISTER_BIND",e.DeregisterBind="DEREGISTER_BIND",e.EstablishChain="ESTABLISH_CHAIN",e.GetComponent="GET_PARENT",e.InvokeFunction="INVOKE_FUNCTION"}(t=e.EventType||(e.EventType={}))}(I||(I={}));var A,B,$=function(e,t,n,i,o){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?o.call(e,n):o?o.value=n:t.set(e,n),n},M=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};class O extends HTMLElement{constructor(){super(),A.set(this,null),B.set(this,null),this.getRegistrationTargets().forEach((e=>dt.reg.registerNode(this,e,this.registeredCallback)))}getRegistrationTargets(){return[this]}registeredCallback(e,t,n){n.setNodeId(e),n.registerBindsWithParentComponent.bind(n)()}setComponent(e){$(this,B,e,"f")}getComponent(){return M(this,B,"f")}setNodeId(e){M(this,A,"f")&&M(this,A,"f")!=e&&dt.print(t.NodeAlreadyHasId,M(this,A,"f"),this),$(this,A,M(this,A,"f")??e,"f")}getNodeId(){return M(this,A,"f")}registerBindsWithParentComponent(){const e=this.getAttribute("b");e&&""!=e?R({requester:this,bind:e,global:this.hasAttribute("global")}):dt.print(n.BindingElementHasNoBindKey,this)}deregisterBindsWithParentComponent(){D({requester:this,bind:this.getAttribute("b"),global:this.hasAttribute("global")})}onParentComponentLoaded(){}bindValueChanged(e){dt.print(n.NoBindingValueUpdateHandler,this.tagName.toLowerCase())}}async function R(e){if(dt.print(n.RegisteringBinding,e.bind,e.requester.tagName.toLowerCase()),e.global)dt.reg.subscribeToBind(e.bind,e.requester.getNodeId(),e.requester.bindValueChanged.bind(e.requester));else{let t=await V(e.requester);const i=t?t.tagName.toLowerCase():null;t?customElements.whenDefined(i).then((()=>function(e,t,i){try{dt.print(n.InitiatingBinding,e.tagName.toLowerCase(),t.tagName.toLowerCase()),e.dispatchEvent(P(!0,e,i)),e.onParentComponentLoaded();const o=t.getState(i);o&&e.bindValueChanged({k:i,v:o})}catch(n){throw console.error("Ika error - Could not send registration"),console.log({requester:e,parentComponent:t}),n}}(e.requester,t,e.bind))):dt.print(n.NoParentFound,e.requester)}}async function D(e){dt.print(n.DeregisteringBinding,e.bind,e.requester.tagName.toLowerCase()),e.global||(await V(e.requester)?e.requester.dispatchEvent(P(!1,e.requester,e.bind)):console.warn(`Registration failed for <${e.requester.tagName.toLowerCase()}>: no parent component found.`))}function P(e,t,n){const i=Number.parseInt(t.getAttribute("leap")),o={type:e?I.EventType.RegisterBind:I.EventType.DeregisterBind,nodeId:t.getNodeId(),payload:{bind:n,issuer:t,leap:Number.isNaN(i)?null:i}};return new CustomEvent(k.ComponentCall,{bubbles:!0,composed:!0,cancelable:!0,detail:o})}async function V(e,t){if(!(e instanceof Element))return console.error("An object that is not a DOM element has been passed into getParentIkaComponent()."),void console.log({element:e,ignoreLeap:t});let n=t?0:Number.parseInt(e.getAttribute("leap"));n=Number.isNaN(n)?0:n;let i=e;for(let t=0;t<=n;t++)do{if(i=o(i),!(i instanceof HTMLElement))return console.log({start:e,leaps:n,i:t,parent:i}),void console.error("Could not find parent Ika component.");await customElements.whenDefined(i.tagName.toLowerCase())}while(i&&!ct(i));return i;function o(e){let t=e,n=!1,i=!0;do{t=t.parentElement||t.parentNode.host,t?n=t.tagName.includes("-"):i=!1}while(!n&&i);return t}}A=new WeakMap,B=new WeakMap;var S,L,U,x,j=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};class F extends O{constructor(){super(),S.add(this),L.set(this,[]),U.set(this,[]),this.addEventListener(k.ComponentCall,this.addDependentSDC)}bindValueChanged(e){const t=j(this,L,"f").some((t=>t==e.k)),n=j(this,U,"f").length>0;!t&&n&&(dt.debug("The <ika-sdc> has affected child"),j(this,U,"f").forEach((e=>e.deregisterBindsWithParentComponent())),function(e,t,n,i,o){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===i?o.call(e,n):o?o.value=n:t.set(e,n)}(this,U,[],"f")),j(this,S,"m",x).call(this)}addDependentSDC(e){if(e.detail.type==I.EventType.EstablishChain&&!e.composedPath()[0].isSameNode(this)){const t=e.detail.payload.issuer;dt.debug(`<ika-sdc> received an EstablishChain event, adding a <${t.tagName.toLowerCase()}> to depedents`),j(this,U,"f").push(t)}}establishChainCb(e,t){this.setComponent(t),e.forEach(((e,t)=>{e instanceof F&&0!=t&&j(this,L,"f").unshift(e.getAttribute("b"))})),j(this,L,"f").length>0&&dt.debug(`<ika-sdc> registered a SDC dependency chain of [${j(this,L,"f").join(", ")}]`)}onParentComponentLoaded(){const e={type:I.EventType.EstablishChain,nodeId:this.getNodeId(),payload:{issuer:this}},t=new CustomEvent(k.ComponentCall,{bubbles:!0,composed:!0,cancelable:!0,detail:e});dt.debug(`%c<${this.tagName.toLowerCase()}>%c component triggering establish chain event.`,[E.ComponentName,"color: unset"]),this.dispatchEvent(t)}}L=new WeakMap,U=new WeakMap,S=new WeakSet,x=function(){const e=this.getComponent().tagName.toLowerCase(),t=this.getAttribute("b"),n=s("sdt",document.getElementsByTagName("ika:templates")[0].children,(t=>t.getAttribute("cn")&&t.getAttribute("cn").toLowerCase()==e)),i=s("stc",n.children,(e=>e.getAttribute("b")==t)),o=s("tamc",i.children,(e=>e.getAttribute("ts")==this.getAttribute("ts"))),r=s("template",o.children,(e=>e instanceof HTMLElement&&e.dataset.a==this.getComponent().getState(t)));if(r){if(!(r instanceof HTMLTemplateElement))return void console.error("Retrieved template arm match element isn't a template.");const e=r.content.cloneNode(!0);this.replaceChildren(...e.childNodes)}else this.replaceChildren();function s(t,n,i){const o=Array.from(n).filter(i);return function(t,n){const i="template"==t?"<template>":`<ika:${t}>`;"<template>"==i?0==n.length&&dt.debug(`No ${i} is a match for the current state.`):n.length>1?console.error(`More than one ${i} is defined for component "${e}"`):0==n.length&&console.error(`No ${i} is defined for component "${e}"`)}(t,o),o[0]}};var W,_,H=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};function q(e){return document.createElement(e)}function K(e,t){Object.entries(e).forEach((e=>t(e)))}function G(e,t){const n={requester:this,bind:`ika-me:${e}`,global:this.hasAttribute("global")};t?D(n):R(n)}function J(e){if([ne.Aside,ne.Remove].includes(e))switch(e){case ne.Aside:if("ika:aside"==this.parentElement?.tagName?.toLowerCase())return;let e=document.getElementsByTagName("ika:aside")[0];e||(e=q("ika:aside"),document.body.firstChild.before(e)),e.appendChild(this);break;case ne.Remove:G.bind(this)(this.getAttribute("ika:is"),!0),this.parentNode.removeChild(this)}}function z(e,t,n,i,o){const r="attr"==e?([e,n])=>t.setAttribute(e,n):([e,n])=>t[e]=n;if(e in n){const t=n[e](i,o);if(null==t)return;if("object"!=typeof t)return void dt.print(a.UnexpectedBDOutputType,t);K(t,(([e,t])=>{["string","number"].includes(typeof t)?r([e,t]):dt.print(a.UnexpectedBDOutputValue,e,t)}))}}function X(e,t,n,i,o,r,s){const d=new DocumentFragment;i.forEach(((i,o)=>{const r=q(e);!function(e,t,n,i){if(t&&(z("attr",e,t,n,i),z("prop",e,t,n,i),t.states)){const r=e.tagName.toLowerCase();e.tagName.includes("-")?customElements.whenDefined(r).then((()=>{e instanceof ot?K(t.states,(([t,o])=>{e.setState(t,o(n,i))})):o()})):o()}function o(){dt.print(a.StateMappingNotOnIkaComponent,t,e.tagName.toLowerCase())}}(r,t[n],i,o),d.appendChild(r)})),Array.isArray(o)&&o.forEach((e=>{const[n,o,r]=["mf","cn","bd"].map((t=>e.getAttribute(t)));d.childNodes.forEach(((s,a)=>X.bind(this)(o,t,r,i[a][n],Q(e),_.Child,s)))}));const c=Array.from(d.childNodes),l=s??this;return r==_.Before?l.parentNode.insertBefore(d,l):l.appendChild(d),c}function Q(e){return Array.from(e.children).filter((e=>"ika:subkey"==e.tagName.toLowerCase()))}W=new WeakMap,function(e){e[e.Before=0]="Before",e[e.Child=1]="Child"}(_||(_={}));var Z,Y,ee,te,ne,ie=function(e,t,n,i,o){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?o.call(e,n):o?o.value=n:t.set(e,n),n},oe=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};!function(e){e.Aside="aside",e.Remove="remove"}(ne||(ne={}));const re=["mf","ika:is","cn"];class se extends HTMLElement{constructor(){super(),Z.set(this,null),Y.set(this,!1),ee.set(this,[]),te.set(this,void 0),ie(this,te,{marker:this,method:[ne.Aside,ne.Remove].includes(this.getAttribute("post"))?_.Before:_.Child},"f")}static get observedAttributes(){return re}attributeChangedCallback(e,t,n){const[i,o,r]=re.map((e=>this.getAttribute(e)));i&&r&&o&&(oe(this,Z,"f")?"ika:is"==e&&t!=n?(G.bind(this)(t,!0),G.bind(this)(n)):oe(this,Y,"f")?this.bindValueChanged({k:`ika-me:${o}`,v:dt.reg.getBindValue(`ika-me:${o}`,oe(this,Z,"f"))}):(G.bind(this)(o),ie(this,Y,!0,"f")):dt.reg.registerNode(this,this,((e,t,n)=>{n.setNodeId(e),G.bind(this)(o),ie(this,Y,!0,"f")})))}bindValueChanged(e){const t=oe(this,te,"f").marker;if(!t.isConnected)throw"Insertion marker no longer connected";const n=this.getAttribute("mf"),i=this.getAttribute("bd")??"_default",o=e.v?.bd;if(!e.v||o?.[i]&&!function(e){if(e.states&&"object"!=typeof e.states)return void dt.print(a.UnexpectedBDStateObject);const t=[e.attr,e.prop,...Object.values(e.states??{})].find((e=>"function"!=typeof e));if(!t)return!0;dt.print(a.UnexpectedBDType,t)}(o[i]))return;(!e.v?.mf||!(n in e.v.mf)||null==e.v.mf[n])&&dt.print(a.NoMapFrom,n);const r=function(e){return e?e instanceof Set?[...e.values()]:e:null}(e.v.mf?.[n]);if(!Array.isArray(r))return void dt.print(a.UnexpectedMFType,r);if(null==r)return;const s=X.bind(this)(this.getAttribute("cn"),o,i,r,Q(this),oe(this,te,"f").method,t),d=this.getAttribute("post");0==s.length&&d==ne.Aside?t.parentNode.insertBefore(this,t):J.bind(this)(d),oe(this,ee,"f").forEach((e=>e.parentNode?.removeChild(e))),ie(this,ee,s,"f"),d==ne.Aside&&(oe(this,te,"f").marker=oe(this,ee,"f")[0]??this)}onParentComponentLoaded(){}setNodeId(e){ie(this,Z,e,"f")}getNodeId(){return oe(this,Z,"f")}}Z=new WeakMap,Y=new WeakMap,ee=new WeakMap,te=new WeakMap;var ae,de,ce=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};class le{constructor(e){ae.set(this,{}),de.set(this,null),function(e,t,n,i,o){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===i?o.call(e,n):o?o.value=n:t.set(e,n)}(this,de,e,"f")}listStates(){if(IKA_CONFIG.debugMode)return ce(this,ae,"f")}subscribeToBind(e,t,i){if(!t||!e||!i)return void dt.print(n.UnregisteredNodeSubscribing,e);const o={nodeId:t,cb:i};if(e in ce(this,ae,"f")){const r=ce(this,ae,"f")[e];if(function(i){if(i.p&&!i.p.rw.includes(t)&&i.p.r&&!i.p.r.includes(t))return dt.print(n.BindingPermissionDenied,t,e),!0}(r))return;r.cb.push(o),i({k:e,v:r.v})}else ce(this,ae,"f")[e]={v:null,cb:[o]};dt.print(n.Subscribed,t,e)}unsubscribeToBind(e,t){!t||t in ce(this,ae,"f")?(t?[t]:Object.keys(ce(this,ae,"f"))).forEach((t=>{ce(this,ae,"f")[t].cb=ce(this,ae,"f")[t].cb.filter((t=>t.nodeId!=e))})):console.warn(`"%c${t}%c" is not a registered bind key.`,E.VariableValue,"color: unset")}clearDeregisteredNode(e){performance.mark("registry-deregister-node-from-binds-start",{detail:{nodeId:e}});const t=Object.entries(ce(this,ae,"f"));t.forEach((([t,n])=>n.cb=n.cb.filter((t=>t.nodeId!=e)))),performance.measure("registry-deregister-node-from-binds-end",{start:"registry-deregister-node-from-binds-start",detail:{nodeId:e,bindsCount:t.length}})}getValue(e,t){if(!e)return void console.error("getValue() must specify a bind key.");if(!ce(this,ae,"f")[e])return console.warn(`Tried reading state "${e}", but it's not defined.`),null;const n=ce(this,ae,"f")[e].p,i=n&&t&&(n.rw.includes(t)||n.r&&n.r.includes(t));if(!n||i)return ce(this,ae,"f")[e].v;console.warn(`Node ID ${t} tried reading state ${e}, but it has no permission to read.`)}deleteNodeFromBindRecords(e,t){this.clearDeregisteredNode(t),dt.reg.deregisterNode(e,t)}setValue(e,t,i,o){if(e in ce(this,ae,"f")){const s=ce(this,ae,"f")[e];if(s.v===t)return;const a=function(t){return t.p&&!i?(console.error(`Error setting bind value "${e}": a node ID must be provided as the binding key is permissioned.`),!1):!(t.p&&!t.p.rw.includes(i))||(console.warn(`"%c${e}%c" is already registered as a permissioned bind, and this node ID is not permissioned for Read/Write.\n                If you meant to register a bind for the first time, nodes with Read/Write permission must unregister it first.`,E.VariableValue,"color: unset"),!1)}(s);if(!a)return;Object.assign(s,{v:t}),o&&r(i,o,s),dt.print(n.BindingValueChanged,e,ce(this,de,"f"),t,ce(this,ae,"f")[e].cb.length),function(e,t){e.forEach((e=>{const n=dt.reg.getNodeFromId(e.nodeId);n?.isConnected?e.cb(t):this.deleteNodeFromBindRecords(n,e.nodeId)}))}.bind(this)(s.cb,{k:e,v:t})}else ce(this,ae,"f")[e]={v:t,cb:[]},o&&r(i,o,ce(this,ae,"f")[e]);function r(t,n,i){if(t){if(i.p&&!i.p.rw.includes(t))return void console.warn(`Setting permissions on bind key "%c${e}%c" is denied. The provided node ID does not have RW permission.`,E.VariableValue,"color: unset");const o=function(e){const t={rw:[]};return Array.isArray(e.rw)&&(t.rw=[...e.rw]),Array.isArray(e.r)&&(t.r=[...e.r]),t}(n);o.rw.push(t),Object.assign(i,{p:o})}else console.warn(`Permissions on bind key "%c${e}%c" is not set, as no node ID was provided.`,E.VariableValue,"color: unset")}}}ae=new WeakMap,de=new WeakMap;var ue,he,fe,pe,me,ge,be,we,ye,ve=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};async function Ne(){const e=[];for(let t=0;t<4;t++)e.push(new Promise((e=>{let t="";for(let e=0;e<6;e++){const e=Math.floor(26*Math.random())+65,n=32*Math.round(Math.random());t+=String.fromCharCode(e+n)}e(t)})));return(await Promise.all(e)).join("-")}async function Ce(){const e=`${window.location.pathname}${window.location.search}${window.location.hash}`;dt.reg.setRoute(window.IKA_ROUTE_CONFIG.rootKey,e,null,{replaceState:!0})}ue=new WeakMap,he=new WeakMap,fe=new WeakMap,pe=new WeakMap,me=new WeakMap,ge=new WeakMap,be=new WeakMap,we=new WeakMap,ye=new WeakMap;class Ee extends HTMLElement{constructor(){super(),this.onclick=function(){const e=this.getAttribute("href"),t=document.getElementById(this.getAttribute("target"));t&&(t.innerHTML=`<ika-import src="${e}"></ika-import>`)}.bind(this)}}var ke,Ie,Te=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};ke=new WeakMap,Ie=new WeakMap;class Ae extends HTMLElement{constructor(){super(),Object.keys(this.dataset).forEach((e=>{$e.bind(this)(`data-${e}`)})),new MutationObserver(Be.bind(this)).observe(this,{attributes:!0,attributeOldValue:!0})}}function Be(e){e.forEach((e=>{"attributes"==e.type&&$e.bind(this)(e.attributeName)}))}function $e(e){if(!e.startsWith("data-"))return;const t=e.slice(5);t&&this.addEventListener(t,(t=>{Me.bind(this)(t,this.getAttribute(e))}))}function Me(e,t){this.hasAttribute("preventDefault")&&(e.cancelable?e.preventDefault():console.warn(`<ika-bf> was instructed to cancel an uncancelabe event of type "${e.type}".`)),Oe.bind(this)(e,t)}function Oe(e,t){const n={type:I.EventType.InvokeFunction,payload:{invocationEvent:e,key:t}},i=Number.parseInt(this.getAttribute("leap"));Number.isInteger(i)&&(n.payload.leap=i);const o=new CustomEvent(k.ComponentCall,{detail:n,bubbles:!0,cancelable:!0,composed:!0});this.dispatchEvent(o)}var Re,De,Pe,Ve,Se=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};class Le extends HTMLElement{constructor(){super(),Re.add(this),De.set(this,void 0),function(e){let t=document.getElementsByTagName("ika:imports")[0];t||(t=document.createElement("ika:imports"),document.head.append(t)),t.appendChild(e)}(this);const e=new URL(this.getAttribute("src"),window.location.href.match(/.+\//)[0]);dt.reg.hasImport(e.href)||(function(e,t,n,i,o){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===i?o.call(e,n):o?o.value=n:t.set(e,n)}(this,De,e,"f"),dt.reg.registerImport(e.href),Se(this,Re,"m",Pe).call(this,fetch(e)))}}function Ue(e){return Array.from(e.scripts).map((e=>{const t=document.createElement("script");return t.text=e.text,Array.from(e.attributes).forEach((e=>t.attributes.setNamedItem(e.cloneNode()))),document.head.appendChild(t),e.remove(),t}))}function xe(e,t,n){const i=e=>e.getElementsByTagName("ika:templates")[0],o=i(e)?.querySelectorAll("template");if(o){let e=i(document);e||(e=document.createElement("ika:templates"),document.head.append(e)),o.forEach((n=>{e.appendChild(n),dt.reg.addTemplateNode(n,n.id,t)}))}else n?.()}De=new WeakMap,Re=new WeakSet,Pe=async function(e){const t=await e;if(!t.ok)return void i(`Status ${t.status}: Could not load resource from ${t.url}`);const n=t.headers.get("content-type").match(/[^;]+/)[0];function i(e){console.error(e)}"text/html"===n?Se(this,Re,"m",Ve).call(this,await t.text()):i(`Unsupported MIME type "${n}" for "${t.url}"`)},Ve=async function(e){const t=(new DOMParser).parseFromString(e,"text/html");xe(t,Se(this,De,"f").href),Ue(t),t.querySelectorAll("ika-import").forEach((e=>!document.querySelector(`ika-import[src="${e.getAttribute("src")}"]`)&&document.body.appendChild(e)))};class je extends HTMLElement{constructor(){super(),dt.reg.setAnchorListener(),dt.reg.registerRouter(this.getAttribute("key"),this);const e=this.getAttribute("src");e&&this.setRoute(e)}async setRoute(e){this.replaceChildren();const t=await fetch(e);if(!t.ok)return void(this.innerHTML=`<span>🚩Failed to load from ${e}</span>`);dt.reg.registerImport(t.url);const n=(new DOMParser).parseFromString(await t.text(),"text/html");!function(e){Array.from(e.querySelectorAll("script[ika-static]")).forEach((e=>{try{const t=JSON.parse(e.textContent);if(!t.headers||!t.data)throw"Invalid static data";(new _e).cache(t.url,t.headers,t.data,t.options,!0),e.remove()}catch(e){throw e}}))}(n);const i=Ue(n);xe(n,t.url),Array.from(n.body.getElementsByTagName("ika:templates")).forEach((e=>e.remove())),n.body.querySelectorAll("link").forEach((e=>n.head.appendChild(e)));const[o,r]=[[...n.body.childNodes],[...n.head.childNodes,...i]];dt.reg.addBodyNodes(t.url,o),dt.reg.addScriptNodes(t.url,r);const a=dt.reg.getImportRegisterByPath(t.url);if(new MutationObserver(((e,n)=>function(e,t,n,i){const o=n.filter((e=>e.removedNodes.length>0));if(0!=o.length){for(const e of o)e.removedNodes.forEach((e=>{const n=t.n.findIndex((t=>t.isSameNode(e)));-1!=n&&t.n.splice(n,1)}));dt.print(s.RemovedNode,e,o,t),0==t.n.length&&(t.t.forEach((e=>{e.parentNode.removeChild(e)})),t.t=[],i.disconnect())}}(t.url,a,e,n))).observe(this,{childList:!0}),dt.print(s.ImportedNodes,e,a),this.append(...o),this.ownerDocument.head.append(...r),!this.hasAttribute("no-scroll-on-route")){const e=this.getBoundingClientRect().top;if(e>=0&&e<window.innerHeight)return;(document.querySelector(this.dataset.scrollToMark)??this).scrollIntoView({behavior:"smooth",block:"start"})}}}var Fe,We;class _e{constructor(){Fe.add(this)}async request(e,t,n,i){const[o,r]=qe(n);if(!e)return void dt.print(h.RequesterHasNoId,o);const s=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)}(this,Fe,"m",We).call(this,r,i);if(s&&dt.print(h.HasCachedData,n,i),dt.reg.subscribeToBind(r,e,(e=>function(e,t,n){const i=He(e.v,n);i&&t({k:e.k,v:i})}(e,t,i))),s)return;dt.print(h.MakingFetch,n,i);const a=await fetch(n,i);if(a.ok){const e=a.headers.get("content-type")?.includes("application/json");this.cache(o,a.headers,e?await a.json():await a.text(),i)}else dt.print(h.FetchFailed,n,i,a.status,await a.text())}cache(e,t,n,i,o){dt.print(h.WritingIntoCache,e,i,n,o);const[r,s]=qe(e),a=[...dt.reg.getBindValue(s)??[]],d={options:i,headers:t,data:n};a.push(d),dt.reg.setBindValue(s,a)}}function He(e,t){const n=function(e){if(!e)return null;const t={...e.headers};return t.Authorization&&delete t.Authorization,{...e,headers:t}}(t);return e.find((e=>{return!t||(i=e.options,o=n,Object.entries(i).every((([e,t])=>e in o&&JSON.stringify(o[e])==JSON.stringify(t))));var i,o}))}function qe(e){const t=e instanceof URL?e.href:e;return[t,`ika:static:${t}`]}function Ke(e,t){if(!t&&(null==e||0==Object.keys(e).length))return;const n=e?Object.keys(e):[],i=new MutationObserver(((i,o)=>{i.forEach((i=>{if(!function(e,t,n,i){if("attributes"==e.type)if(n||i.includes(e.attributeName)){if(e.target.isSameNode(t))return!0;dt.print(r.MutationTargetUnexpected,e)}else dt.print(r.NotAttributeMutation,e);else dt.print(r.NotAttributeMutation,e)}(i,this,null!=t,n))return;const o=i.oldValue,s=i.target instanceof HTMLElement&&i.target.getAttribute(i.attributeName);Ge.bind(this)(i.attributeName,e,t)(i.attributeName,o,s)}))})),o={attributes:!0,attributeOldValue:!0};t||(o.attributeFilter=n),i.observe(this,o),Array.from(this.attributes).forEach((n=>{(t||n.name in e)&&Ge.bind(this)(n.name,e,t)(n.name,null,n.value)}))}function Ge(e,t,n){return(t&&t[e]||n).bind(this)}async function Je(e,t){const n=e||this.tagName.toLowerCase(),o=this.tagName.toLowerCase(),r=await dt.reg.getComponentTemplate(n);if(!(r&&r instanceof HTMLTemplateElement))return void console.error(`Error creating component ${o}:\n A template with ID ${n} is not found.`);if("TEMPLATE"!==r.tagName)throw new Error(`Template element with id ${n} is not a template`);dt.print(i.Building,this);const s=this.getAttribute("ika:is")||"_default";t&&t[s]?Object.entries(t[s]).forEach((([e,t])=>this.setState(e,t))):dt.print(i.NoStateDataWhenInitialising,this.tagName.toLowerCase(),s);const a=r.content.cloneNode(!0),d=Array.from(this.childNodes).filter((e=>!(e instanceof Element)||e instanceof Element&&!e.hasAttribute("slot")));this.attachShadow({mode:"open"}).append(a,...d)}function ze(e){const t=e.composedPath()[0];if(function(e){if(t instanceof Node&&t.isSameNode(this))return!1;const n=[I.EventType.RegisterBind,I.EventType.DeregisterBind,I.EventType.GetComponent,I.EventType.InvokeFunction];if(e.type==k.ComponentCall&&e instanceof CustomEvent&&n.includes(e.detail.type)){const t=e.detail,n=t.payload.leap;if(Number.isInteger(n)&&n>0)return t.payload.leap--,!1}return!0}.bind(this)(e))if(e instanceof CustomEvent)switch(e.stopPropagation(),e.detail.type){case I.EventType.RegisterBind:{const t=e.detail.payload,n=t.bind,i=t.issuer;if(!i.getNodeId||!i.bindValueChanged)throw`Component <${this.tagName.toLowerCase()}> received a register bind event, but the event issuer is not a binding component.`;this.subscribeToBind.bind(this)(n,i.getNodeId(),i.bindValueChanged.bind(i));break}case I.EventType.DeregisterBind:{const t=e.detail.payload;this.unsubscribeToBind.bind(this)(t.issuer.getNodeId());break}case I.EventType.EstablishChain:{const t=e.detail.payload;["IKA-SDC"].includes(t.issuer.tagName)&&d.payload.issuer.establishChainCb(e.composedPath(),c);break}case I.EventType.GetComponent:e.detail.payload.cb(this);break;case I.EventType.InvokeFunction:this.invokeFunction(e.detail.payload.key,e.detail.payload.invocationEvent,e.detail.payload.params);break;default:console.error("Unrecognised component call type. The event call is %o",e)}else dt.print(i.ReceviedComponentCallNoDetail,this.tagName.toLowerCase(),e)}function Xe(e){function t(e,t){const n=e.composedPath()[0];n instanceof HTMLElement?(dt.print(i.ReceivedEvent,this.tagName.toLowerCase(),e),t.bind(this)(e)):dt.print(i.ReceivedEventNotFromElement,n)}e||(e={}),e[k.ComponentCall]=ze,Object.entries(e).forEach((([e,n])=>{this.addEventListener(e,(e=>t.bind(this)(e,n)))}))}Fe=new WeakSet,We=function(e,t){const n=dt.reg.getBindValue(e);return n?He(n,t):null};var Qe,Ze,Ye,et,tt,nt=function(e,t,n,i,o){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?o.call(e,n):o?o.value=n:t.set(e,n),n},it=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};class ot extends O{constructor(e){var t;let n;super(),Qe.set(this,void 0),Ze.set(this,{}),Ye.set(this,{}),et.set(this,[]),tt.set(this,void 0),nt(this,tt,new Promise((e=>n=e)),"f"),nt(this,Qe,new le(this),"f"),nt(this,Ye,e?.bundle?.m,"f"),nt(this,Ze,e||{},"f"),(t=it(this,Ze,"f")).attributesWatched??(t.attributesWatched={}),it(this,Ze,"f").attributesWatched["ika:b"]=rt,Xe.bind(this)(e?.eventBinds);const o=function(){Ke.bind(this)(it(this,Ze,"f").attributesWatched,e?.attributeChangedCallback);try{e?.construct&&e.construct.bind(this)(this),it(this,et,"f").length>0&&dt.reg.registerNode(this,this,this.registeredCallback),n(),IKA_CONFIG.debugMode&&function(e){const t=document.createElement("div");t.setAttribute("style","display: var(--global-debug-button-display)");const n=document.createElement("button");n.innerHTML=e.tagName.toLowerCase(),n.setAttribute("style","margin: 0.5rem 0; background: #666; color: #eee; padding: 0.25rem; border: 1px solid #222; cursor: pointer;"),n.onclick=t=>{t.stopPropagation(),e.debugPrint()},t.append(n),(e.shadowRoot??e).append(t)}(this),dt.print(i.Built,this)}catch(e){}}.bind(this);e?.noTemplate?o():Je.bind(this)(e?.templateId,e?.bundle?.s).then(o)}connectedCallback(){this.runLifecycleMethodIfExists("connectedCallback")}disconnectedCallback(){this.runLifecycleMethodIfExists("disconnectedCallback")}adoptedCallback(){this.runLifecycleMethodIfExists("adoptedCallback")}runLifecycleMethodIfExists(e){e in it(this,Ze,"f")&&it(this,Ze,"f")[e](this)}getIkaVersion(){return at}registeredCallback(e,t,n){n.setNodeId(e),n.registerBindsWithParentComponent.bind(n)(),n.getOnNodeRegisteredQueue().forEach((e=>e()))}registerBindsWithParentComponent(){const e=this.hasAttribute("global");Object.values(this.dataset).forEach((t=>{R({requester:this,bind:t,global:e})}))}async invokeFunction(e,...t){if(await it(this,tt,"f"),it(this,Ye,"f")&&it(this,Ye,"f")[e])try{return it(this,Ye,"f")[e].bind(this)(...t)}catch(t){console.error(`Error while invoking function "${e}" on component <${this.tagName.toLowerCase()}>`,t)}else console.warn(`Check that the function binding "${e}" is correct, as it is not found for the component.`)}async subscribeToBind(e,t,n){it(this,Qe,"f").subscribeToBind(e,t,n)}unsubscribeToBind(e,t){it(this,Qe,"f").unsubscribeToBind(e,t)}bindValueChanged(e){Object.entries(this.dataset).filter((([t,n])=>e.k==n)).forEach((([t,n])=>this.setState(t,e.v)))}getState(e){return it(this,Qe,"f").getValue(e)}setState(e,t){void 0!==t&&it(this,Qe,"f").setValue(e,t)}linkState(e,t,n){it(this,et,"f").push(function(){const i=n?e=>this.setState(n,t.bind(this)(e.v)):e=>t.bind(this)(e.v);this.subscribeToBind(e,this.getNodeId(),i)}.bind(this)),this.getNodeId()||dt.reg.registerNode(this,this,this.registeredCallback)}getOnNodeRegisteredQueue(){return[...it(this,et,"f")]}onNodeRegistered(e){this.getNodeId()?e.bind(this)():it(this,et,"f").push(e.bind(this))}getRegistrationTargets(){return[]}debugPrint(){console.log(it(this,Qe,"f").listStates())}}function rt(e,t,n){this.hasAttribute("ika:b")&&(this.getNodeId()?this.registerBindsWithParentComponent():dt.reg.registerNode(this,this,this.registeredCallback))}function st(e,t){try{customElements.define(e,class extends ot{constructor(){super(t)}})}catch(t){if(9!=t.code)throw t;dt.debug(`Element %c${e}%c is already defined. Now potentially using a new template.`,[E.ComponentName,"color: unset"])}}Qe=new WeakMap,Ze=new WeakMap,Ye=new WeakMap,et=new WeakMap,tt=new WeakMap,performance.mark("ika-init");const at="0.2.0",dt={debug:function(e,t,n){if(!IKA_CONFIG.verbose)return;const i=["color: #6aaff8; font-weight: 600","color: unset; font-weight: unset"];for(const o of e.matchAll(/(%[co])/g)){const e="%c"==o[0]?t:n;i.push(e[0]),e.shift()}console.debug("%c‹debug› %c"+e,...i)},print:function(e,...t){const n=IKA_CONFIG.locale||"en-gb",i={debug:"#6aaff8",warn:"orange",error:"red"};if(IKA_CONFIG.verbose){if(IKA_CONFIG?.suppressMessages?.includes(e)||IKA_CONFIG?.filterMessages&&!IKA_CONFIG?.filterMessages?.includes(e))return;const{s:o,css:r,o:s,mode:a}=C[n][e].apply(null,t),d=[`color: ${i[a||"debug"]}; font-weight: 600`,"color: unset; font-weight: unset"];for(const e of o.matchAll(/(%[co])/g)){const t="%c"==e[0]?r:s;if(!Array.isArray(t))return;d.push(t[0]),t.shift()}console[a||"debug"](`%c<${a||"debug"}>%c `+o,...d)}},buffer:new class{constructor(){m.set(this,{})}debug(){return{buffer:g(this,m,"f")}}push(e){if(!["string","number","boolean"].includes(typeof e.v))return void dt.print(l.UnexpectedData,e);const t=g(this,m,"f");function n(e,t,n){e[t]||(e[t]=n)}n(t,e.n,{}),n(t[e.n],e.type,{}),n(t[e.n][e.type],e.k,[]),t[e.n][e.type][e.k].push(e.v)}getBuffer(){return function(e){const t={};return Object.entries(e).forEach((([e,n])=>{t[e]={},Object.entries(n).forEach((([n,i])=>{t[e][n]={},Object.entries(i).forEach((([i,o])=>{t[e][n][i]=[...o]}))}))})),t}(g(this,m,"f"))}resetBuffer(){!function(e,t,n,i,o){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===i?o.call(e,n):o?o.value=n:t.set(e,n)}(this,m,{},"f")}},reg:new class{constructor(){ue.set(this,{}),he.set(this,{}),fe.set(this,{}),pe.set(this,new le(this)),me.set(this,new v),ge.set(this,[]),be.set(this,{}),we.set(this,{}),ye.set(this,void 0)}debugPrint(){IKA_CONFIG.debugMode&&console.log(ve(this,pe,"f").listStates())}getPathMD5(e){return ve(this,he,"f")[e]}async registerComponentImport(e,t){ve(this,he,"f")[e]=await async function(e){const t=await crypto.subtle.digest("SHA-1",(new TextEncoder).encode(e));return Array.from(new Uint8Array(t)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(t)}hasImport(e){return e in ve(this,ue,"f")}registerImport(e){ve(this,ue,"f")[e]={t:[],n:[]}}addTemplateNode(e,t,n){ve(this,ue,"f")[n].t.push(e),ve(this,we,"f")[t]?.forEach((e=>e()))}addBodyNodes(e,t){ve(this,ue,"f")[e].n.push(...Array.from(t).filter((e=>e.nodeType!=Node.TEXT_NODE)))}addScriptNodes(e,t){ve(this,ue,"f")[e].t.push(...Array.from(t).filter((e=>e.nodeType!=Node.TEXT_NODE)))}getImportRegisterByPath(e){return ve(this,ue,"f")[e]}async getComponentTemplate(e){var t;let n,i=r(e);if(i)return i;(t=ve(this,we,"f"))[e]??(t[e]=[]);const o=new Promise((e=>n=e));return ve(this,we,"f")[e].push(n),await o,r(e);function r(e){let t=document.querySelector(`#${e}`);if(t){if(t instanceof HTMLTemplateElement)return t;throw new Error(`Template with ID "${e}" is not a template element.`)}}}subscribeToBind(e,t,n){ve(this,pe,"f").subscribeToBind(e,t,n)}unsubscribeToBind(e,t){ve(this,pe,"f").unsubscribeToBind(e,t)}setBindValue(e,t,n,i){ve(this,pe,"f").setValue(e,t,n,i)}getBindValue(e,t){return ve(this,pe,"f").getValue(e,t)}registerNode(e,n,i){function o(n){if(n instanceof HTMLElement&&(n instanceof ot||n instanceof se)&&n.getNodeId())return;const o=Object.entries(ve(this,fe,"f")).find((([e,t])=>t.isSameNode(n)));return o?(dt.print(t.AlreadyRegistered,o[0],n),void i(o[0],n,e)):!ve(this,ge,"f").find((e=>e.isSameNode(n)))||void 0}ve(this,me,"f").queue().then((()=>{e&&n||console.error("Could not register node - requester and element must be supplied."),o.bind(this)(n)?(this.getNewIdThenInvokeCallback(n,i,e),ve(this,ge,"f").push(n),ve(this,me,"f").next()):ve(this,me,"f").next()}))}getNodeFromId(e){return e in ve(this,fe,"f")||console.warn(`A query is made for node id %c${e} %c, and the ID was not registered.`,"color: #999","color: unset"),ve(this,fe,"f")[e]}deregisterNode(e,n){ve(this,fe,"f")[n]?ve(this,fe,"f")[n].isSameNode(e)?(delete ve(this,fe,"f")[n],ve(this,pe,"f").clearDeregisteredNode(n),dt.print(t.Deregistered,e.tagName.toLowerCase(),n)):console.warn(`Trying to deregister node ID %c${n}%c, but the supplied node was not the same as records.`,"color: #999","color: unset"):console.warn(`Trying to deregister node ID %c${n}%c, but the ID was not registered.`,"color: #999","color: unset")}getRegistry(){if(IKA_CONFIG.debugMode)return ve(this,fe,"f")}async getNewIdThenInvokeCallback(e,n,i){let o;do{o=await Ne()}while(o in ve(this,fe,"f"));ve(this,fe,"f")[o]=e,ve(this,ge,"f").splice(ve(this,ge,"f").findIndex((t=>t.isSameNode(e))),1),dt.print(t.Registered,e,o),n(o,e,i)}registerRouter(e,t){const n=0==Object.keys(ve(this,be,"f")).length;e in ve(this,be,"f")&&dt.print(u.OverwritingKey,e,t),ve(this,be,"f")[e]={n:t,p:null},n&&(window.IKA_ROUTE_CONFIG.unprotected||Object.freeze(window.IKA_ROUTE_CONFIG),Ce(),window.addEventListener("popstate",Ce))}unregisterRouter(e){delete ve(this,be,"f")[e],0==Object.keys(ve(this,be,"f")).length&&this.unsetAnchorListener()}async setRoute(e,t,n,i){if(!(e in ve(this,be,"f")))return void console.warn(`Trying to set route "${e}" but it was not registered.`);const o=ve(this,be,"f")[e];if(!o.n.isConnected)return void delete ve(this,be,"f")[e];const r=new URL(t,window.location.href),[s,a]=await async function(e,t,n){const i=window.IKA_ROUTE_CONFIG,o=i.rules.find((t=>"string"==typeof t.path?t.path==e:t.path instanceof RegExp?t.path.test(e):void 0)),r=o?o.res:`${i.resourceDir??""}${e}`,s=o?await async function(e,t){return"function"==typeof e?await e(t):e}(o.state,e):null;return[r,s]}(r.pathname,r.searchParams,r.hash);(o.p!=s||i?.force)&&(o.n.setRoute(s),o.p=s),history[i?.replaceState?"replaceState":"pushState"](n??a,null,i?.setPath??t),window.dispatchEvent(new CustomEvent("ika:popstate",{detail:{state:n??a}}))}getRoute(e){return ve(this,be,"f")[e].p}setAnchorListener(){ve(this,ye,"f")||(function(e,t,n,i,o){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===i?o.call(e,n):o?o.value=n:t.set(e,n)}(this,ye,new AbortController,"f"),document.addEventListener("click",(e=>{const t=e.composedPath()[0];if(t instanceof HTMLAnchorElement){const n=t.dataset.ikaTarget;if(!n)return;e.preventDefault();const i=t.getAttribute("href");this.setRoute(n,i)}}),{signal:ve(this,ye,"f").signal}))}unsetAnchorListener(){ve(this,ye,"f")?.abort()}},data:new class{constructor(){W.set(this,{})}add(e,t){if("string"!=typeof e)throw"Initialisation bundle object must have a string component name.";H(this,W,"f")[e]=t}get(e){return H(this,W,"f")[e]}},ResourceManager:new _e};function ct(e){return"function"==typeof Object.getPrototypeOf(e).getIkaVersion&&Object.getPrototypeOf(e).getIkaVersion()==at}window.IKA_CONFIG??(window.IKA_CONFIG={}),window.IKA_ROUTE_CONFIG??(window.IKA_ROUTE_CONFIG={rules:[]}),Object.entries({UPS:60,locale:"en-gb"}).forEach((([e,t])=>{var n;(n=window.IKA_CONFIG)[e]??(n[e]=t)})),window.IKA_CONFIG.unprotected||Object.freeze(window.IKA_CONFIG),dt.print(o.Initialising,at),document.addEventListener(k.ComponentCall,(e=>{console.warn("Ika event was not caught and has reached document boundary."),console.log(e)})),customElements.define("ika-a",Ee),customElements.define("ika-b",class extends O{constructor(){super()}bindValueChanged(t){dt.buffer.push({n:this.getNodeId(),type:e.PROP,v:t.v,k:this.hasAttribute("allow-html")?"innerHTML":"textContent"})}}),customElements.define("ika-bf",Ae),customElements.define("ika-me",se),customElements.define("ika-import",Le),customElements.define("ika-ab",class extends O{constructor(){super(),ke.set(this,[]),Ie.set(this,{}),this.processBinds.bind(this)(),this.hasAttribute("unwrap")&&this.before(...this.childNodes)}async processBinds(){const e=this.hasAttribute("context")?(await V(this,!0)).getState(this.getAttribute("context")):null;!function(e,t,n,i,o){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===i?o.call(e,n):o?o.value=n:t.set(e,n)}(this,ke,Object.entries(this.dataset).map((([t,n])=>[t.replace(/[A-Z]/,"-$&"),e?`${n}_${e}`:n])),"f")}getRegistrationTargets(){return[this,...this.children]}registeredCallback(e,t,n){t.isSameNode(n)?(n.setNodeId(e),n.registerBindsWithParentComponent.bind(n)()):n.setChildId.bind(n)(e,t)}setChildId(e,t){Te(this,Ie,"f")[e]=t,t.tagName.includes("-")&&customElements.whenDefined(t.tagName.toLowerCase()).then((()=>{(t instanceof O||t instanceof se)&&t.setNodeId(e)}))}registerBindsWithParentComponent(){Te(this,ke,"f").forEach((([e,t])=>{R({requester:this,bind:t,global:this.hasAttribute("global")})}))}bindValueChanged(t){const i=Te(this,ke,"f").filter((([e,n])=>n==t.k)).map((([e,t])=>e));dt.print(n.IkaABReceivedBindingUpdate,this,t.k,t.v,i,Te(this,Ie,"f")),Array.from(this.children).length!=Object.keys(Te(this,Ie,"f")).length&&dt.debug("<ika-ab> current children do not match number of childIds. They may have been moved out of <ika-ab>'s child nodes."),i.forEach((n=>{Object.keys(Te(this,Ie,"f")).forEach((i=>{const o="."==n.charAt(0);dt.buffer.push({n:i,type:o?e.PROP:e.ATTR,k:o?n.substring(1):n,v:t.v})}))}))}}),customElements.define("ika-sdc",F),customElements.define("ika-route",je),document.addEventListener("DOMContentLoaded",(e=>{setInterval(b,1e3/IKA_CONFIG.UPS)})),dt.print(o.BufferStart),performance.measure("ika-init-complete","ika-init");var lt=p.Fd,ut=p.RV,ht=p._K,ft=p.Gm,pt=p.fc,mt=p.$o,gt=p.JX,bt=p.v1,wt=p.uL,yt=p.c8;export{lt as ComponentCall,ut as CustomEventTypes,ht as IKA_VERSION,ft as IkaComponent,pt as ResourceManager,mt as UpdateType,gt as defineIkaComponent,bt as elementIsIkaComponent,wt as getParentIkaComponent,yt as ika};
//# sourceMappingURL=ika.js.map